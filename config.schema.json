{
  "pluginAlias": "HomebridgeHomeWizardEnergySocket",
  "pluginType": "platform",
  "singular": true,
  "headerDisplay": "Please [read the README](https://github.com/jvandenaardweg/homebridge-homewizard-energy-socket#readme) of the plugin for more information and instructions on how to configure it.",

  "schema": {
    "type": "object",
    "properties": {
      "name": {
        "title": "Bridge name",
        "type": "string",
        "required": true,
        "placeholder": "HomeWizard Energy Socket",
        "description": "You'll see this name when you add the bridge in your Home app and also in the logs within Homebridge.",
        "default": "HomeWizard Energy Socket"
      },
      "energySockets": {
        "type": "array",
        "items": {
          "type": "object",
          "properties": {
            "name": {
              "type": "string",
              "title": "Name",
              "placeholder": "What is plugged in?",
              "required": true
            },
            "ip": {
              "type": "string",
              "title": "IP Address",
              "placeholder": "192.168.0.10",
              "format": "ipv4",
              "required": true
            },
            "outletInUse": {
              "type": "object",
              "properties": {
                "isActive": {
                  "title": "Use Outlet in Use?",
                  "type": "boolean",
                  "required": false,
                  "default": false,
                  "description": "When enabled, the \"Outlet In Use\" characteristic will be shown as \"Yes\" if the device plugged in the Energy Socket is consuming a certain amount of power. You can trigger automations based on this characteristic.<br /><a href='https://github.com/jvandenaardweg/homebridge-homewizard-energy-socket/wiki/About-the-Outlet-In-Use-characteristic' target='_blank'>Learn more about it in the Wiki</a>."
                },
                "threshold": {
                  "title": "Threshold (watts)",
                  "placeholder": "Power usage in watts",
                  "type": "number",
                  "required": true,
                  "default": 5,
                  "minimum": 0.1,
                  "maximum": 3680,
                  "description": "When the power consumption is higher than this threshold, the \"Outlet In Use\" characteristic will be shown as \"Yes\" in the Home app. Otherwise it shows \"No\". Defaults to 1 watt.",
                  "condition": {
                    "functionBody": "return model.energySockets[arrayIndices].outletInUse.isActive === true;"
                  }
                },
                "thresholdDuration": {
                  "title": "Threshold Duration (seconds)",
                  "placeholder": "Duration in seconds",
                  "type": "number",
                  "required": true,
                  "default": 10,
                  "minimum": 0,
                  "maximum": 86400,
                  "description": "When the power consumption is higher than the threshold for this duration, the \"Outlet In Use\" characteristic will be shown as \"Yes\" in the Home app. Otherwise it shows \"No\". Defaults to 10 seconds.",
                  "condition": {
                    "functionBody": "return model.energySockets[arrayIndices].outletInUse.isActive === true;"
                  }
                }
              }
            }
          }
        }
      }
    }
  },
  "layout": [
    {
      "type": "flex",
      "flex-flow": "row wrap",
      "orderable": false,
      "items": [
        {
          "key": "name",
          "type": "name"
        }
      ]
    },
    {
      "type": "fieldset",
      "title": "Energy Sockets",
      "description": "<strong>This config option is optional.</strong> Only use this if you want to bypass automatic discovery or use only the Energy Sockets you define here. When no Energy Sockets are defined here, the plugin will automatically discover all Energy Sockets on your network.",
      "expandable": true,
      "orderable": false,
      "items": [
        {
          "type": "help",
          "helpvalue": "<p class='help-block'>To make communication with the Energy Socket reliable, make sure that it has a static IP address. You can set it from your router admin interface. More about that in the <a href='https://github.com/jvandenaardweg/homebridge-homewizard-energy-socket#readme' target='_blank'>README</a>.</p>"
        },
        {
          "title": "Energy Socket",
          "key": "energySockets",
          "type": "array",
          "notitle": true,
          "orderable": false,
          "items": [
            {
              "type": "flex",
              "flex-flow": "row wrap",
              "items": [
                {
                  "type": "flex",
                  "flex-flow": "row wrap",
                  "items": [
                    {
                      "key": "energySockets[].name"
                    },
                    {
                      "key": "energySockets[].ip"
                    }
                  ]
                },
                {
                  "type": "flex",
                  "flex-flow": "row wrap",
                  "items": [
                    {
                      "key": "energySockets[].outletInUse.isActive"
                    },
                    {
                      "key": "energySockets[].outletInUse.threshold"
                    },
                    {
                      "key": "energySockets[].outletInUse.thresholdDuration"
                    }
                  ]
                }
              ]
            }
          ]
        }
      ]
    }
  ]
}
